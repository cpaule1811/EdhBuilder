import { expect, test } from '@jest/globals';
import {
    groupRawCardDtos,
    legalityStrToTruthy,
    mapRawCardDtosToCard,
    mapRawCardDtosToCards,
    readCardsFromJson
} from "../services/cardBulkDataService";
import { Card } from "../models/Card";
import { mockCardDtos } from "./mockData/mockCardDtos";
import { mockGroupedCardDtos } from "./mockData/mockGroupedCardDtos";
import { rawCardDto } from "../dtos/rawCardDto";

const cardsAsJson = `[{"object":"card","id":"0000579f-7b35-4ed3-b44c-db2a538066fe","oracle_id":"44623693-51d6-49ad-8cd7-140505caf02f","multiverse_ids":[109722],"mtgo_id":25527,"mtgo_foil_id":25528,"tcgplayer_id":14240,"cardmarket_id":13850,"name":"Fury Sliver","lang":"en","released_at":"2006-10-06","uri":"https://api.scryfall.com/cards/0000579f-7b35-4ed3-b44c-db2a538066fe","scryfall_uri":"https://scryfall.com/card/tsp/157/fury-sliver?utm_source=api","layout":"normal","highres_image":true,"image_status":"highres_scan","image_uris":{"small":"https://cards.scryfall.io/small/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979","normal":"https://cards.scryfall.io/normal/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979","large":"https://cards.scryfall.io/large/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979","png":"https://cards.scryfall.io/png/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.png?1562894979","art_crop":"https://cards.scryfall.io/art_crop/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979","border_crop":"https://cards.scryfall.io/border_crop/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979"},"mana_cost":"{5}{R}","cmc":6.0,"type_line":"Creature — Sliver","oracle_text":"All Sliver creatures have double strike.","power":"3","toughness":"3","colors":["R"],"color_identity":["R"],"keywords":[],"legalities":{"standard":"not_legal","future":"not_legal","historic":"not_legal","gladiator":"not_legal","pioneer":"not_legal","explorer":"not_legal","modern":"legal","legacy":"legal","pauper":"not_legal","vintage":"legal","penny":"legal","commander":"legal","brawl":"not_legal","historicbrawl":"not_legal","alchemy":"not_legal","paupercommander":"restricted","duel":"legal","oldschool":"not_legal","premodern":"not_legal"},"games":["paper","mtgo"],"reserved":false,"foil":true,"nonfoil":true,"finishes":["nonfoil","foil"],"oversized":false,"promo":false,"reprint":false,"variation":false,"set_id":"c1d109bc-ffd8-428f-8d7d-3f8d7e648046","set":"tsp","set_name":"Time Spiral","set_type":"expansion","set_uri":"https://api.scryfall.com/sets/c1d109bc-ffd8-428f-8d7d-3f8d7e648046","set_search_uri":"https://api.scryfall.com/cards/search?order=set\u0026q=e%3Atsp\u0026unique=prints","scryfall_set_uri":"https://scryfall.com/sets/tsp?utm_source=api","rulings_uri":"https://api.scryfall.com/cards/0000579f-7b35-4ed3-b44c-db2a538066fe/rulings","prints_search_uri":"https://api.scryfall.com/cards/search?order=released\u0026q=oracleid%3A44623693-51d6-49ad-8cd7-140505caf02f\u0026unique=prints","collector_number":"157","digital":false,"rarity":"uncommon","flavor_text":"\\"A rift opened, and our arrows were abruptly stilled. To move was to push the world. But the sliver's claw still twitched, red wounds appeared in Thed's chest, and ribbons of blood hung in the air.\\"\\n—Adom Capashen, Benalish hero","card_back_id":"0aeebaf5-8c7d-4636-9e82-8c27447861f7","artist":"Paolo Parente","artist_ids":["d48dd097-720d-476a-8722-6a02854ae28b"],"illustration_id":"2fcca987-364c-4738-a75b-099d8a26d614","border_color":"black","frame":"2003","full_art":false,"textless":false,"booster":true,"story_spotlight":false,"edhrec_rank":5643,"penny_rank":10572,"prices":{"usd":"0.30","usd_foil":"4.50","usd_etched":null,"eur":"0.20","eur_foil":"1.84","tix":"0.02"},"related_uris":{"gatherer":"https://gatherer.wizards.com/Pages/Card/Details.aspx?multiverseid=109722","tcgplayer_infinite_articles":"https://infinite.tcgplayer.com/search?contentMode=article\u0026game=magic\u0026partner=scryfall\u0026q=Fury+Sliver\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","tcgplayer_infinite_decks":"https://infinite.tcgplayer.com/search?contentMode=deck\u0026game=magic\u0026partner=scryfall\u0026q=Fury+Sliver\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","edhrec":"https://edhrec.com/route/?cc=Fury+Sliver"}},{"object":"card","id":"00006596-1166-4a79-8443-ca9f82e6db4e","oracle_id":"8ae3562f-28b7-4462-96ed-be0cf7052ccc","multiverse_ids":[189637],"mtgo_id":34586,"mtgo_foil_id":34587,"tcgplayer_id":33347,"cardmarket_id":21851,"name":"Kor Outfitter","lang":"en","released_at":"2009-10-02","uri":"https://api.scryfall.com/cards/00006596-1166-4a79-8443-ca9f82e6db4e","scryfall_uri":"https://scryfall.com/card/zen/21/kor-outfitter?utm_source=api","layout":"normal","highres_image":true,"image_status":"highres_scan","image_uris":{"small":"https://cards.scryfall.io/small/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.jpg?1562609251","normal":"https://cards.scryfall.io/normal/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.jpg?1562609251","large":"https://cards.scryfall.io/large/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.jpg?1562609251","png":"https://cards.scryfall.io/png/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.png?1562609251","art_crop":"https://cards.scryfall.io/art_crop/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.jpg?1562609251","border_crop":"https://cards.scryfall.io/border_crop/front/0/0/00006596-1166-4a79-8443-ca9f82e6db4e.jpg?1562609251"},"mana_cost":"{W}{W}","cmc":2.0,"type_line":"Creature — Kor Soldier","oracle_text":"When Kor Outfitter enters the battlefield, you may attach target Equipment you control to target creature you control.","power":"2","toughness":"2","colors":["W"],"color_identity":["W"],"keywords":[],"legalities":{"standard":"not_legal","future":"not_legal","historic":"not_legal","gladiator":"not_legal","pioneer":"not_legal","explorer":"not_legal","modern":"legal","legacy":"legal","pauper":"legal","vintage":"legal","penny":"legal","commander":"legal","brawl":"not_legal","historicbrawl":"not_legal","alchemy":"not_legal","paupercommander":"legal","duel":"legal","oldschool":"not_legal","premodern":"not_legal"},"games":["paper","mtgo"],"reserved":false,"foil":true,"nonfoil":true,"finishes":["nonfoil","foil"],"oversized":false,"promo":false,"reprint":false,"variation":false,"set_id":"eb16a2bd-a218-4e4e-8339-4aa1afc0c8d2","set":"zen","set_name":"Zendikar","set_type":"expansion","set_uri":"https://api.scryfall.com/sets/eb16a2bd-a218-4e4e-8339-4aa1afc0c8d2","set_search_uri":"https://api.scryfall.com/cards/search?order=set\u0026q=e%3Azen\u0026unique=prints","scryfall_set_uri":"https://scryfall.com/sets/zen?utm_source=api","rulings_uri":"https://api.scryfall.com/cards/00006596-1166-4a79-8443-ca9f82e6db4e/rulings","prints_search_uri":"https://api.scryfall.com/cards/search?order=released\u0026q=oracleid%3A8ae3562f-28b7-4462-96ed-be0cf7052ccc\u0026unique=prints","collector_number":"21","digital":false,"rarity":"common","flavor_text":"\\"We take only what we need to survive. Believe me, you will need this.\\"","card_back_id":"0aeebaf5-8c7d-4636-9e82-8c27447861f7","artist":"Kieran Yanner","artist_ids":["aa7e89ed-d294-4633-9057-ce04dacfcfa4"],"illustration_id":"de0310d1-e97f-46e0-bc16-c980c2adedee","border_color":"black","frame":"2003","full_art":false,"textless":false,"booster":true,"story_spotlight":false,"edhrec_rank":13881,"penny_rank":4756,"prices":{"usd":"0.15","usd_foil":"6.91","usd_etched":null,"eur":"0.25","eur_foil":"2.49","tix":"0.03"},"related_uris":{"gatherer":"https://gatherer.wizards.com/Pages/Card/Details.aspx?multiverseid=189637","tcgplayer_infinite_articles":"https://infinite.tcgplayer.com/search?contentMode=article\u0026game=magic\u0026partner=scryfall\u0026q=Kor+Outfitter\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","tcgplayer_infinite_decks":"https://infinite.tcgplayer.com/search?contentMode=deck\u0026game=magic\u0026partner=scryfall\u0026q=Kor+Outfitter\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","edhrec":"https://edhrec.com/route/?cc=Kor+Outfitter"}},{"object":"card","id":"0000a54c-a511-4925-92dc-01b937f9afad","oracle_id":"dc4e2134-f0c2-49aa-9ea3-ebf83af1445c","multiverse_ids":[],"tcgplayer_id":98659,"name":"Spirit","lang":"en","released_at":"2015-05-22","uri":"https://api.scryfall.com/cards/0000a54c-a511-4925-92dc-01b937f9afad","scryfall_uri":"https://scryfall.com/card/tmm2/5/spirit?utm_source=api","layout":"token","highres_image":true,"image_status":"highres_scan","image_uris":{"small":"https://cards.scryfall.io/small/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.jpg?1562701869","normal":"https://cards.scryfall.io/normal/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.jpg?1562701869","large":"https://cards.scryfall.io/large/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.jpg?1562701869","png":"https://cards.scryfall.io/png/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.png?1562701869","art_crop":"https://cards.scryfall.io/art_crop/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.jpg?1562701869","border_crop":"https://cards.scryfall.io/border_crop/front/0/0/0000a54c-a511-4925-92dc-01b937f9afad.jpg?1562701869"},"mana_cost":"","cmc":0.0,"type_line":"Token Creature — Spirit","oracle_text":"Flying","power":"1","toughness":"1","colors":["W"],"color_identity":["W"],"keywords":["Flying"],"all_parts":[{"object":"related_card","id":"4d8542f6-ee34-42c6-acd5-07b0c7cc2f63","component":"combo_piece","name":"Funeral Pyre","type_line":"Instant","uri":"https://api.scryfall.com/cards/4d8542f6-ee34-42c6-acd5-07b0c7cc2f63"},{"object":"related_card","id":"68e5693f-8414-4e1d-8a05-8bd920969f30","component":"combo_piece","name":"Haunted Dead","type_line":"Creature — Zombie","uri":"https://api.scryfall.com/cards/68e5693f-8414-4e1d-8a05-8bd920969f30"},{"object":"related_card","id":"a2713730-fe6b-46b6-9189-de349c712fee","component":"combo_piece","name":"Blessed Defiance","type_line":"Instant","uri":"https://api.scryfall.com/cards/a2713730-fe6b-46b6-9189-de349c712fee"},{"object":"related_card","id":"287f9774-90b7-4b5b-ba29-80669e64d12a","component":"combo_piece","name":"Slayer's Plate","type_line":"Artifact — Equipment","uri":"https://api.scryfall.com/cards/287f9774-90b7-4b5b-ba29-80669e64d12a"},{"object":"related_card","id":"278e97cf-312d-4e9e-bc39-023f4e547121","component":"combo_piece","name":"Lingering Souls","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/278e97cf-312d-4e9e-bc39-023f4e547121"},{"object":"related_card","id":"8a840ee7-5728-4b1b-92ac-54612e5397b3","component":"combo_piece","name":"Gallows at Willow Hill","type_line":"Artifact","uri":"https://api.scryfall.com/cards/8a840ee7-5728-4b1b-92ac-54612e5397b3"},{"object":"related_card","id":"dd4287fc-3e16-473f-818c-9f4d57d03125","component":"combo_piece","name":"Kaya the Inexorable","type_line":"Legendary Planeswalker — Kaya","uri":"https://api.scryfall.com/cards/dd4287fc-3e16-473f-818c-9f4d57d03125"},{"object":"related_card","id":"362ec364-39c1-4a4b-8dfa-268fad2effdd","component":"combo_piece","name":"Nearheath Chaplain","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/362ec364-39c1-4a4b-8dfa-268fad2effdd"},{"object":"related_card","id":"e6d09b61-5529-4906-91a6-5259fb180442","component":"combo_piece","name":"Ethereal Investigator","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/e6d09b61-5529-4906-91a6-5259fb180442"},{"object":"related_card","id":"a3f29cbb-d802-4085-a236-86775764bc9e","component":"combo_piece","name":"Whispering Wizard","type_line":"Creature — Human Wizard","uri":"https://api.scryfall.com/cards/a3f29cbb-d802-4085-a236-86775764bc9e"},{"object":"related_card","id":"9964629e-d79e-46e4-b3fd-e7d1759cbc60","component":"combo_piece","name":"Spectral Procession","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/9964629e-d79e-46e4-b3fd-e7d1759cbc60"},{"object":"related_card","id":"0df01c9a-5d2c-4391-99a3-f10e404b7133","component":"combo_piece","name":"Abzan Ascendancy","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/0df01c9a-5d2c-4391-99a3-f10e404b7133"},{"object":"related_card","id":"d080c35d-f2c6-4f4e-8f7c-305b319d4cde","component":"combo_piece","name":"Benevolent Offering","type_line":"Instant","uri":"https://api.scryfall.com/cards/d080c35d-f2c6-4f4e-8f7c-305b319d4cde"},{"object":"related_card","id":"1b302947-5d66-425d-b67e-bf1d5846d490","component":"combo_piece","name":"Nurturing Presence","type_line":"Enchantment — Aura","uri":"https://api.scryfall.com/cards/1b302947-5d66-425d-b67e-bf1d5846d490"},{"object":"related_card","id":"9d258bcc-3379-4f56-b584-be25979e5244","component":"combo_piece","name":"Triplicate Spirits","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/9d258bcc-3379-4f56-b584-be25979e5244"},{"object":"related_card","id":"258946f2-294a-4ddf-be91-9ff4c94e4bdb","component":"combo_piece","name":"Afterlife","type_line":"Instant","uri":"https://api.scryfall.com/cards/258946f2-294a-4ddf-be91-9ff4c94e4bdb"},{"object":"related_card","id":"020dc072-96e2-4923-b9c9-1791a0732c29","component":"combo_piece","name":"Field of Souls","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/020dc072-96e2-4923-b9c9-1791a0732c29"},{"object":"related_card","id":"6f9a11d2-e422-430d-af2a-525fc4a2e2cc","component":"combo_piece","name":"Kirtar's Wrath","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/6f9a11d2-e422-430d-af2a-525fc4a2e2cc"},{"object":"related_card","id":"74deeeaa-95e9-42c9-89e3-e317ea63e216","component":"combo_piece","name":"Moorland Haunt","type_line":"Land","uri":"https://api.scryfall.com/cards/74deeeaa-95e9-42c9-89e3-e317ea63e216"},{"object":"related_card","id":"dc8037d5-79fa-47e3-9d3b-eb29643ecae7","component":"combo_piece","name":"Hallowed Spiritkeeper","type_line":"Creature — Avatar","uri":"https://api.scryfall.com/cards/dc8037d5-79fa-47e3-9d3b-eb29643ecae7"},{"object":"related_card","id":"ad135475-d1f6-4e78-a536-6bf61204c739","component":"combo_piece","name":"Requiem Angel","type_line":"Creature — Angel","uri":"https://api.scryfall.com/cards/ad135475-d1f6-4e78-a536-6bf61204c739"},{"object":"related_card","id":"7618aa2d-d5b3-41e6-978f-2c8292f7f896","component":"combo_piece","name":"Spectral Reserves","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/7618aa2d-d5b3-41e6-978f-2c8292f7f896"},{"object":"related_card","id":"996ac78f-ad5f-44d5-8567-3d88934c5a71","component":"combo_piece","name":"Mausoleum Guard","type_line":"Creature — Human Scout","uri":"https://api.scryfall.com/cards/996ac78f-ad5f-44d5-8567-3d88934c5a71"},{"object":"related_card","id":"add661e7-b337-44e4-9614-ca958e20e86f","component":"combo_piece","name":"Occult Epiphany","type_line":"Instant","uri":"https://api.scryfall.com/cards/add661e7-b337-44e4-9614-ca958e20e86f"},{"object":"related_card","id":"7676deeb-b80d-49c9-b810-5ed0a68fa618","component":"combo_piece","name":"Hanged Executioner","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/7676deeb-b80d-49c9-b810-5ed0a68fa618"},{"object":"related_card","id":"fb911c45-9f6a-4cf2-aa1e-4361cf170c17","component":"combo_piece","name":"Millicent, Restless Revenant","type_line":"Legendary Creature — Spirit Soldier","uri":"https://api.scryfall.com/cards/fb911c45-9f6a-4cf2-aa1e-4361cf170c17"},{"object":"related_card","id":"54a25105-fa66-46da-8920-52a8e5fe016a","component":"combo_piece","name":"Kykar, Wind's Fury","type_line":"Legendary Creature — Bird Wizard","uri":"https://api.scryfall.com/cards/54a25105-fa66-46da-8920-52a8e5fe016a"},{"object":"related_card","id":"6fbc9abd-8719-4cea-8bf4-1a3d78e3f00b","component":"combo_piece","name":"Priest of the Blessed Graf","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/6fbc9abd-8719-4cea-8bf4-1a3d78e3f00b"},{"object":"related_card","id":"e732cdf6-b127-4c6b-aa8a-109ddafa0aef","component":"combo_piece","name":"Thalisse, Reverent Medium","type_line":"Legendary Creature — Human Cleric","uri":"https://api.scryfall.com/cards/e732cdf6-b127-4c6b-aa8a-109ddafa0aef"},{"object":"related_card","id":"c9786c13-b57a-46be-bbbe-e17333defbd4","component":"combo_piece","name":"Sanctifier of Souls","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/c9786c13-b57a-46be-bbbe-e17333defbd4"},{"object":"related_card","id":"4716ede8-d08e-426b-aed3-8cf36c9b51c9","component":"combo_piece","name":"Teysa, Orzhov Scion","type_line":"Legendary Creature — Human Advisor","uri":"https://api.scryfall.com/cards/4716ede8-d08e-426b-aed3-8cf36c9b51c9"},{"object":"related_card","id":"972e9a78-204b-4012-b394-b40fd0edac4c","component":"combo_piece","name":"Avacyn's Collar","type_line":"Artifact — Equipment","uri":"https://api.scryfall.com/cards/972e9a78-204b-4012-b394-b40fd0edac4c"},{"object":"related_card","id":"83632e73-be3f-43fc-932f-45cb1af4f8fb","component":"combo_piece","name":"Valor of the Worthy","type_line":"Enchantment — Aura","uri":"https://api.scryfall.com/cards/83632e73-be3f-43fc-932f-45cb1af4f8fb"},{"object":"related_card","id":"4205f8f8-7b18-4999-ac51-860fab376d79","component":"combo_piece","name":"Brine Comber // Brinebound Gift","type_line":"Creature — Spirit // Enchantment — Aura","uri":"https://api.scryfall.com/cards/4205f8f8-7b18-4999-ac51-860fab376d79"},{"object":"related_card","id":"c3ac419f-7630-48c7-9039-88ce28898b6d","component":"combo_piece","name":"Luminous Angel","type_line":"Creature — Angel","uri":"https://api.scryfall.com/cards/c3ac419f-7630-48c7-9039-88ce28898b6d"},{"object":"related_card","id":"29bf245f-e8e0-4d32-8cd7-06d832609910","component":"combo_piece","name":"Seize the Soul","type_line":"Instant","uri":"https://api.scryfall.com/cards/29bf245f-e8e0-4d32-8cd7-06d832609910"},{"object":"related_card","id":"3a79a435-9b58-4bcd-8544-79d9a71d85a2","component":"combo_piece","name":"Heron-Blessed Geist","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/3a79a435-9b58-4bcd-8544-79d9a71d85a2"},{"object":"related_card","id":"5642cdda-789f-4125-a9ff-7c445bb51950","component":"combo_piece","name":"Doomed Traveler","type_line":"Creature — Human Soldier","uri":"https://api.scryfall.com/cards/5642cdda-789f-4125-a9ff-7c445bb51950"},{"object":"related_card","id":"4399dcc7-7684-4345-9f74-318c3ec9af82","component":"combo_piece","name":"Midnight Haunting","type_line":"Instant","uri":"https://api.scryfall.com/cards/4399dcc7-7684-4345-9f74-318c3ec9af82"},{"object":"related_card","id":"a36ab7fa-7b90-4ccc-8fe9-93453f10a237","component":"combo_piece","name":"Drogskol Cavalry","type_line":"Creature — Spirit Knight","uri":"https://api.scryfall.com/cards/a36ab7fa-7b90-4ccc-8fe9-93453f10a237"},{"object":"related_card","id":"9b0f860c-029c-4856-a999-05b3306c7d46","component":"combo_piece","name":"Spirit Cairn","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/9b0f860c-029c-4856-a999-05b3306c7d46"},{"object":"related_card","id":"1cbdffab-b171-4e7c-906f-d04aa722cf40","component":"combo_piece","name":"Bishop of Wings","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/1cbdffab-b171-4e7c-906f-d04aa722cf40"},{"object":"related_card","id":"ef2bb440-87b7-4d3d-9b37-2f1ebaca4b3f","component":"combo_piece","name":"Twilight Drover","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/ef2bb440-87b7-4d3d-9b37-2f1ebaca4b3f"},{"object":"related_card","id":"f07dd0f1-b80b-4af0-ae76-907ec55ec7d5","component":"combo_piece","name":"March of Souls","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/f07dd0f1-b80b-4af0-ae76-907ec55ec7d5"},{"object":"related_card","id":"87673b63-cacb-43b3-8723-924a7d5aed0c","component":"combo_piece","name":"Confront the Assault","type_line":"Instant","uri":"https://api.scryfall.com/cards/87673b63-cacb-43b3-8723-924a7d5aed0c"},{"object":"related_card","id":"f4051020-688c-473a-9a08-b62f0fd75675","component":"combo_piece","name":"Vessel of Ephemera","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/f4051020-688c-473a-9a08-b62f0fd75675"},{"object":"related_card","id":"fc3b97d0-8245-48de-aa05-e6800c0339ad","component":"combo_piece","name":"Dauntless Cathar","type_line":"Creature — Human Soldier","uri":"https://api.scryfall.com/cards/fc3b97d0-8245-48de-aa05-e6800c0339ad"},{"object":"related_card","id":"1c8c41dd-8551-4ce8-a9be-9b9f65718852","component":"combo_piece","name":"Ranar the Ever-Watchful","type_line":"Legendary Creature — Spirit Warrior","uri":"https://api.scryfall.com/cards/1c8c41dd-8551-4ce8-a9be-9b9f65718852"},{"object":"related_card","id":"6a0dd7ba-673e-4f69-8cd3-806784501dc2","component":"combo_piece","name":"Custodi Soulbinders","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/6a0dd7ba-673e-4f69-8cd3-806784501dc2"},{"object":"related_card","id":"95174fbf-ff47-49a0-9986-0374f190f4a1","component":"combo_piece","name":"Alharu, Solemn Ritualist","type_line":"Legendary Creature — Human Monk","uri":"https://api.scryfall.com/cards/95174fbf-ff47-49a0-9986-0374f190f4a1"},{"object":"related_card","id":"7ebb3b03-943e-4b5a-be04-f59316b81333","component":"token","name":"Spirit","type_line":"Token Creature — Spirit","uri":"https://api.scryfall.com/cards/7ebb3b03-943e-4b5a-be04-f59316b81333"},{"object":"related_card","id":"86a4c348-1012-4339-960a-c7bc7fd84fbb","component":"combo_piece","name":"Clarion Spirit","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/86a4c348-1012-4339-960a-c7bc7fd84fbb"},{"object":"related_card","id":"9135b501-82be-43cb-9aa5-9cf08789c636","component":"combo_piece","name":"Kaya, Geist Hunter","type_line":"Legendary Planeswalker — Kaya","uri":"https://api.scryfall.com/cards/9135b501-82be-43cb-9aa5-9cf08789c636"},{"object":"related_card","id":"66ecdadf-56f7-4dfb-9c3c-7d240ba19b00","component":"combo_piece","name":"Not Forgotten","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/66ecdadf-56f7-4dfb-9c3c-7d240ba19b00"},{"object":"related_card","id":"4d09ef1d-3552-43a3-91c7-0d14c0f06780","component":"combo_piece","name":"Geist-Honored Monk","type_line":"Creature — Human Monk","uri":"https://api.scryfall.com/cards/4d09ef1d-3552-43a3-91c7-0d14c0f06780"},{"object":"related_card","id":"1b7a47cc-9311-4f92-b19c-8956db5f2b5f","component":"combo_piece","name":"Rousing of Souls","type_line":"Sorcery","uri":"https://api.scryfall.com/cards/1b7a47cc-9311-4f92-b19c-8956db5f2b5f"},{"object":"related_card","id":"72015ce0-0579-4776-a6a3-251f40c218ae","component":"combo_piece","name":"Haunted Library","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/72015ce0-0579-4776-a6a3-251f40c218ae"},{"object":"related_card","id":"c342e1da-7ab9-4e29-96e6-77d820a45ede","component":"combo_piece","name":"Elgaud Inquisitor","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/c342e1da-7ab9-4e29-96e6-77d820a45ede"},{"object":"related_card","id":"4531482d-9238-40de-957e-61beb5700330","component":"combo_piece","name":"Thalia's Geistcaller","type_line":"Creature — Human Cleric","uri":"https://api.scryfall.com/cards/4531482d-9238-40de-957e-61beb5700330"},{"object":"related_card","id":"cc5fa496-a830-4031-a19a-d6467d074ad1","component":"combo_piece","name":"Emissary of the Sleepless","type_line":"Creature — Spirit","uri":"https://api.scryfall.com/cards/cc5fa496-a830-4031-a19a-d6467d074ad1"},{"object":"related_card","id":"aa2a3aaa-e78a-48cc-b7d3-7f65e467054c","component":"combo_piece","name":"Spirit Bonds","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/aa2a3aaa-e78a-48cc-b7d3-7f65e467054c"},{"object":"related_card","id":"318ce4ef-38bd-4360-895f-457587164197","component":"combo_piece","name":"Transluminant","type_line":"Creature — Dryad Shaman","uri":"https://api.scryfall.com/cards/318ce4ef-38bd-4360-895f-457587164197"},{"object":"related_card","id":"c1475050-a377-45b3-b319-a36e716afdd8","component":"combo_piece","name":"Court of Grace","type_line":"Enchantment","uri":"https://api.scryfall.com/cards/c1475050-a377-45b3-b319-a36e716afdd8"},{"object":"related_card","id":"b34a7501-4afc-4467-b0d6-b32d7657064e","component":"combo_piece","name":"Sandsteppe Outcast","type_line":"Creature — Human Warrior","uri":"https://api.scryfall.com/cards/b34a7501-4afc-4467-b0d6-b32d7657064e"}],"legalities":{"standard":"not_legal","future":"not_legal","historic":"not_legal","gladiator":"not_legal","pioneer":"not_legal","explorer":"not_legal","modern":"not_legal","legacy":"not_legal","pauper":"not_legal","vintage":"not_legal","penny":"not_legal","commander":"not_legal","brawl":"not_legal","historicbrawl":"not_legal","alchemy":"not_legal","paupercommander":"not_legal","duel":"not_legal","oldschool":"not_legal","premodern":"not_legal"},"games":["paper"],"reserved":false,"foil":false,"nonfoil":true,"finishes":["nonfoil"],"oversized":false,"promo":false,"reprint":true,"variation":false,"set_id":"f7aa47c6-c1e2-4de5-9a68-4406d84bd6bb","set":"tmm2","set_name":"Modern Masters 2015 Tokens","set_type":"token","set_uri":"https://api.scryfall.com/sets/f7aa47c6-c1e2-4de5-9a68-4406d84bd6bb","set_search_uri":"https://api.scryfall.com/cards/search?order=set\u0026q=e%3Atmm2\u0026unique=prints","scryfall_set_uri":"https://scryfall.com/sets/tmm2?utm_source=api","rulings_uri":"https://api.scryfall.com/cards/0000a54c-a511-4925-92dc-01b937f9afad/rulings","prints_search_uri":"https://api.scryfall.com/cards/search?order=released\u0026q=oracleid%3Adc4e2134-f0c2-49aa-9ea3-ebf83af1445c\u0026unique=prints","collector_number":"5","digital":false,"rarity":"common","card_back_id":"0aeebaf5-8c7d-4636-9e82-8c27447861f7","artist":"Mike Sass","artist_ids":["155bc2cb-038d-4b1f-9990-6178db1d1a21"],"illustration_id":"1dbe0618-dd47-442c-acf6-ac5e4b136e5a","border_color":"black","frame":"2015","full_art":false,"textless":false,"booster":true,"story_spotlight":false,"promo_types":["setpromo"],"prices":{"usd":"0.08","usd_foil":null,"usd_etched":null,"eur":null,"eur_foil":null,"tix":null},"related_uris":{"tcgplayer_infinite_articles":"https://infinite.tcgplayer.com/search?contentMode=article\u0026game=magic\u0026partner=scryfall\u0026q=Spirit\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","tcgplayer_infinite_decks":"https://infinite.tcgplayer.com/search?contentMode=deck\u0026game=magic\u0026partner=scryfall\u0026q=Spirit\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","edhrec":"https://edhrec.com/route/?cc=Spirit"}},{"object":"card","id":"0000cd57-91fe-411f-b798-646e965eec37","oracle_id":"9f0d82ae-38bf-45d8-8cda-982b6ead1d72","multiverse_ids":[435231],"mtgo_id":65170,"mtgo_foil_id":65171,"arena_id":66119,"tcgplayer_id":145764,"cardmarket_id":301766,"name":"Siren Lookout","lang":"en","released_at":"2017-09-29","uri":"https://api.scryfall.com/cards/0000cd57-91fe-411f-b798-646e965eec37","scryfall_uri":"https://scryfall.com/card/xln/78/siren-lookout?utm_source=api","layout":"normal","highres_image":true,"image_status":"highres_scan","image_uris":{"small":"https://cards.scryfall.io/small/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.jpg?1562549609","normal":"https://cards.scryfall.io/normal/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.jpg?1562549609","large":"https://cards.scryfall.io/large/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.jpg?1562549609","png":"https://cards.scryfall.io/png/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.png?1562549609","art_crop":"https://cards.scryfall.io/art_crop/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.jpg?1562549609","border_crop":"https://cards.scryfall.io/border_crop/front/0/0/0000cd57-91fe-411f-b798-646e965eec37.jpg?1562549609"},"mana_cost":"{2}{U}","cmc":3.0,"type_line":"Creature — Siren Pirate","oracle_text":"Flying\\nWhen Siren Lookout enters the battlefield, it explores. (Reveal the top card of your library. Put that card into your hand if it's a land. Otherwise, put a +1/+1 counter on this creature, then put the card back or put it into your graveyard.)","power":"1","toughness":"2","colors":["U"],"color_identity":["U"],"keywords":["Flying","Explore"],"legalities":{"standard":"not_legal","future":"not_legal","historic":"legal","gladiator":"legal","pioneer":"legal","explorer":"legal","modern":"legal","legacy":"legal","pauper":"legal","vintage":"legal","penny":"legal","commander":"legal","brawl":"not_legal","historicbrawl":"legal","alchemy":"not_legal","paupercommander":"legal","duel":"legal","oldschool":"not_legal","premodern":"not_legal"},"games":["arena","paper","mtgo"],"reserved":false,"foil":true,"nonfoil":true,"finishes":["nonfoil","foil"],"oversized":false,"promo":false,"reprint":false,"variation":false,"set_id":"fe0dad85-54bc-4151-9200-d68da84dd0f2","set":"xln","set_name":"Ixalan","set_type":"expansion","set_uri":"https://api.scryfall.com/sets/fe0dad85-54bc-4151-9200-d68da84dd0f2","set_search_uri":"https://api.scryfall.com/cards/search?order=set\u0026q=e%3Axln\u0026unique=prints","scryfall_set_uri":"https://scryfall.com/sets/xln?utm_source=api","rulings_uri":"https://api.scryfall.com/cards/0000cd57-91fe-411f-b798-646e965eec37/rulings","prints_search_uri":"https://api.scryfall.com/cards/search?order=released\u0026q=oracleid%3A9f0d82ae-38bf-45d8-8cda-982b6ead1d72\u0026unique=prints","collector_number":"78","digital":false,"rarity":"common","card_back_id":"0aeebaf5-8c7d-4636-9e82-8c27447861f7","artist":"Chris Rallis","artist_ids":["a8e7b854-b15a-421a-b66d-6e68187ae285"],"illustration_id":"e0a40a54-9216-4c86-b9e3-daed04abc310","border_color":"black","frame":"2015","full_art":false,"textless":false,"booster":true,"story_spotlight":false,"edhrec_rank":12082,"penny_rank":8378,"prices":{"usd":"0.03","usd_foil":"0.27","usd_etched":null,"eur":"0.09","eur_foil":"0.25","tix":"0.03"},"related_uris":{"gatherer":"https://gatherer.wizards.com/Pages/Card/Details.aspx?multiverseid=435231","tcgplayer_infinite_articles":"https://infinite.tcgplayer.com/search?contentMode=article\u0026game=magic\u0026partner=scryfall\u0026q=Siren+Lookout\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","tcgplayer_infinite_decks":"https://infinite.tcgplayer.com/search?contentMode=deck\u0026game=magic\u0026partner=scryfall\u0026q=Siren+Lookout\u0026utm_campaign=affiliate\u0026utm_medium=api\u0026utm_source=scryfall","edhrec":"https://edhrec.com/route/?cc=Siren+Lookout"}}]`;

describe("cardBulkDataService", () => {
    test('readCardsFromJson_WhenGivenValidPathToJson_ShouldReturnCards', () => {
        const expectedCount = 4;

        const result: rawCardDto[] = readCardsFromJson(cardsAsJson);
        const resultCount = result.length

        expect(expectedCount).toEqual(resultCount);
    });

    test('groupJsonCardDtos_WhenGivenCardDtos_ShouldReturnGroupedArray', () => {
        const expectedGroupsCount: number = 4;
        const expectedFirstGroupCount: number = 2;

        const result: rawCardDto[][] = groupRawCardDtos(mockCardDtos);
        const actualGroupsCount: number = result.length;
        const actualFirstGroupCount: number = result[0].length;

        expect(expectedGroupsCount).toEqual(actualGroupsCount);
        expect(expectedFirstGroupCount).toEqual(actualFirstGroupCount);
    })

    test("legalityStringToTruthy_WhenGivenLegalString_ShouldReturnTrue", () => {
        const testLegalityStr = "legal";

        const result = legalityStrToTruthy(testLegalityStr);

        expect(result).toBeTruthy();
    })

    test("legalityStringToTruthy_WhenGivenNonLegalString_ShouldReturnFalse", () => {
        const testLegalityStr = "not_legal";

        const result = legalityStrToTruthy(testLegalityStr);

        expect(result).toBeFalsy();
    })

    test("mapCardDtosToCard_WhenGivenGroupedCardDto_ShouldReturnCard", () => {
        const expectedResult: Card = {
            _id: "44623693-51d6-49ad-8cd7-140505caf02f",
            name: "Fury Sliver",
            lang: "en",
            layout: "normal",
            oracleText: "All Sliver creatures have double strike.",
            power: "3",
            toughness: "3",
            typeLine: "Creature — Sliver",
            manaCost: "{5}{R}",
            cmc: 6,
            colors: ["R"],
            colorIdentity: ["R"],
            colorIndicator: ["R"],
            keywords: [],
            allParts: [],
            cardVersions: [
                {
                    artCrop: "https://cards.scryfall.io/art_crop/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979",
                    artist: "Paolo Parente",
                    borderColor: "black",
                    cardImage: "https://cards.scryfall.io/normal/front/0/0/0000579f-7b35-4ed3-b44c-db2a538066fe.jpg?1562894979",
                    isFoil: true,
                    isPromo: false,
                    isReprint: false,
                    rarity: "uncommon",
                    set: "tsp",
                    setName: "Time Spiral"
                },
                {
                    artCrop: "https://cards.scryfall.io/art_crop/front/a/8/a8a64329-09fc-4e0d-b7d1-378635f2801a.jpg?1619396979",
                    artist: "Paolo Parente",
                    borderColor: "black",
                    cardImage: "https://cards.scryfall.io/normal/front/a/8/a8a64329-09fc-4e0d-b7d1-378635f2801a.jpg?1619396979",
                    isFoil: true,
                    isPromo: false,
                    isReprint: true,
                    rarity: "uncommon",
                    set: "tsr",
                    setName: "Time Spiral Remastered"
                }
            ],
            legalities: {
                brawl: false,
                commander: true,
                legacy: true,
                modern: true,
                pioneer: false,
                standard: false,
                vintage: true
            }
        }

        const result: Card = mapRawCardDtosToCard(mockGroupedCardDtos[0])

        expect(result).toEqual(expectedResult)
    })

    test("mapRawCardDtosToCards_WhenGivenCardDtos_ShouldReturnCards", () => {
        const expectedCount: number = 4;

        const result: Card[] = mapRawCardDtosToCards(mockGroupedCardDtos);
        const resultCount: number = result.length;

        expect(resultCount).toEqual(expectedCount)
    })
})